dist: focal
language: python
python:
- '3.8'
branches:
  only:
  - master
  - "/^\\d+\\.\\d+\\.\\d+$/"
jobs:
  include:
    - name: tanguan
      install:
        - pip install tox
      script:
        - tox -e tanguan
      after_success:
        - pip install python-coveralls
        - coverage report
        - coveralls
    - name: bunpun
      install:
        - pip install tox
      script:
        - tox -e bunpun
      after_success:
        - pip install python-coveralls
        - coverage report
        - coveralls
    - name: HTS
      install:
        - pip install tox
      script:
        - tox -e HTS
      after_success:
        - pip install python-coveralls
        - coverage report
        - coveralls
    - name: KenLM
      install:
        - pip install tox
      script:
        - tox -e KenLM
      after_success:
        - pip install python-coveralls
        - coverage report
        - coveralls
    - name: flake8
      install:
        - pip install tox
      script:
        - tox -e flake8
    - name: sonarcloud
      addons:
        sonarcloud:
          organization: "ithuan"
          token: ${SONAR_TOKEN}
      script:
        - |
          sonar-scanner \
            -Dsonar.organization=ithuan \
            -Dsonar.projectKey=ithuan_tai5-uan5_gian5-gi2_kang1-ku7 \
            -Dsonar.sources=. \
            -Dsonar.host.url=https://sonarcloud.io
    - stage: deploy
      name: pypi
      if: branch ~= /\d+\.\d+\.\d+/
      script: skip
      deploy:
        provider: pypi
        username: __token__
        password: ${PYPI_PASSWORD}
        on:
          tags: true
    - name: gh-page bunkiann
      if: type == push AND branch == master
      install:
        - pip install tox
      script:
       - tox -e bunkiann
      deploy:
        provider: pages
        skip_cleanup: true
        github_token: ${GITHUB_TOKEN}
        local_dir: "html"
        on:
          branch: master
